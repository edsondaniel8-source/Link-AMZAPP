<!doctype html>
<html lang="pt">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Upload de Documentos - Firebase Storage</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 600px;
                margin: 50px auto;
                padding: 20px;
                background-color: #f5f5f5;
            }

            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .upload-area {
                border: 2px dashed #ccc;
                border-radius: 8px;
                padding: 40px;
                text-align: center;
                background: #f9f9f9;
                margin: 20px 0;
            }

            .upload-btn {
                background: #4caf50;
                color: white;
                padding: 12px 24px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                transition: background 0.3s;
            }

            .upload-btn:hover {
                background: #45a049;
            }

            .upload-btn:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            .progress-container {
                margin: 20px 0;
                display: none;
            }

            .progress-bar {
                width: 100%;
                height: 20px;
                background: #f0f0f0;
                border-radius: 10px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: #4caf50;
                width: 0%;
                transition: width 0.3s;
            }

            .progress-text {
                margin-top: 10px;
                font-weight: bold;
                color: #333;
            }

            .status {
                margin: 15px 0;
                padding: 10px;
                border-radius: 5px;
                display: none;
            }

            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üìÑ Upload de Documentos</h1>
            <p>Selecione uma foto do seu BI, Passaporte ou Carta de Condu√ß√£o</p>

            <div class="upload-area">
                <p>üì∑ Clique no bot√£o para selecionar sua foto</p>

                <!-- Input file escondido -->
                <input
                    type="file"
                    id="fileInput"
                    accept="image/*"
                    style="display: none"
                />

                <!-- Bot√£o vis√≠vel -->
                <button class="upload-btn" id="selectBtn">
                    Selecionar Foto
                </button>
            </div>

            <!-- Barra de progresso -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">
                    Preparando upload...
                </div>
            </div>

            <!-- Status messages -->
            <div class="status" id="statusMessage"></div>
        </div>

        <!-- Firebase SDKs -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import {
                getStorage,
                ref,
                uploadBytesResumable,
                getDownloadURL,
            } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

            // CONFIGURA√á√ÉO DO FIREBASE
            // ‚ö†Ô∏è SUBSTITUA com suas pr√≥prias credenciais Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyArFapbYfnr5h99MMO5WqVw9s65UVTJBQc",
                authDomain: "link-a-turismo-mozambique.firebaseapp.com",
                projectId: "link-a-turismo-mozambique",
                storageBucket: "link-a-turismo-mozambique.firebasestorage.app",
                messagingSenderId: "1058402037541",
                appId: "1:1058402037541:web:9ca4e189a375426e3b34cc",
            };

            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const storage = getStorage(app);

            // Elementos do DOM
            const fileInput = document.getElementById("fileInput");
            const selectBtn = document.getElementById("selectBtn");
            const progressContainer =
                document.getElementById("progressContainer");
            const progressFill = document.getElementById("progressFill");
            const progressText = document.getElementById("progressText");
            const statusMessage = document.getElementById("statusMessage");

            // Fun√ß√£o para mostrar status
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = `status ${type}`;
                statusMessage.style.display = "block";
            }

            // Fun√ß√£o para esconder status
            function hideStatus() {
                statusMessage.style.display = "none";
            }

            // Fun√ß√£o para mostrar progresso
            function showProgress() {
                progressContainer.style.display = "block";
            }

            // Fun√ß√£o para esconder progresso
            function hideProgress() {
                progressContainer.style.display = "none";
            }

            // Bot√£o "Selecionar Foto" clica no input escondido
            selectBtn.addEventListener("click", (e) => {
                e.preventDefault();
                console.log("üî• BOT√ÉO CLICADO!");
                hideStatus();

                // Clica no input file escondido
                fileInput.click();
                console.log("‚úÖ Input file acionado!");
            });

            // Quando usu√°rio seleciona um arquivo
            fileInput.addEventListener("change", (e) => {
                const file = e.target.files[0];

                if (!file) {
                    console.log("‚ùå Nenhum arquivo selecionado");
                    return;
                }

                console.log("üìÅ Arquivo selecionado:", file.name);
                console.log(
                    "üìè Tamanho:",
                    (file.size / 1024 / 1024).toFixed(2) + " MB",
                );
                console.log("üé≠ Tipo:", file.type);

                // Validar se √© uma imagem
                if (!file.type.startsWith("image/")) {
                    showStatus(
                        "‚ùå Por favor, selecione apenas arquivos de imagem!",
                        "error",
                    );
                    return;
                }

                // Fazer upload do arquivo
                uploadFile(file);
            });

            // Fun√ß√£o para fazer upload
            function uploadFile(file) {
                hideStatus();
                showProgress();

                // Gerar nome √∫nico para o arquivo
                const timestamp = new Date().getTime();
                const fileName = `${timestamp}_${file.name}`;

                console.log("üöÄ Iniciando upload para:", fileName);

                // Criar refer√™ncia no Firebase Storage na pasta "documentos/"
                const storageRef = ref(storage, `documentos/${fileName}`);

                // Criar upload task
                const uploadTask = uploadBytesResumable(storageRef, file);

                // Desabilitar bot√£o durante upload
                selectBtn.disabled = true;
                selectBtn.textContent = "Enviando...";

                // Monitorar progresso do upload
                uploadTask.on(
                    "state_changed",
                    (snapshot) => {
                        // Calcular progresso
                        const progress =
                            (snapshot.bytesTransferred / snapshot.totalBytes) *
                            100;

                        console.log(`üìä Progresso: ${progress.toFixed(2)}%`);
                        console.log(
                            `üì§ Enviado: ${(snapshot.bytesTransferred / 1024 / 1024).toFixed(2)} MB`,
                        );
                        console.log(
                            `üì¶ Total: ${(snapshot.totalBytes / 1024 / 1024).toFixed(2)} MB`,
                        );

                        // Atualizar barra de progresso
                        progressFill.style.width = progress + "%";
                        progressText.textContent = `Enviando... ${Math.round(progress)}%`;

                        switch (snapshot.state) {
                            case "paused":
                                console.log("‚è∏Ô∏è Upload pausado");
                                break;
                            case "running":
                                console.log("üèÉ Upload em andamento");
                                break;
                        }
                    },
                    (error) => {
                        // Erro durante upload
                        console.error("‚ùå Erro no upload:", error);

                        hideProgress();
                        showStatus(
                            "‚ùå Erro ao enviar arquivo. Tente novamente.",
                            "error",
                        );

                        // Reabilitar bot√£o
                        selectBtn.disabled = false;
                        selectBtn.textContent = "Selecionar Foto";
                    },
                    () => {
                        // Upload conclu√≠do com sucesso
                        console.log("‚úÖ Upload conclu√≠do!");

                        // Obter URL de download
                        getDownloadURL(uploadTask.snapshot.ref).then(
                            (downloadURL) => {
                                console.log(
                                    "üîó Link de download:",
                                    downloadURL,
                                );
                                console.log("üìÅ Nome do arquivo:", fileName);
                                console.log("üìÇ Pasta:", "documentos/");

                                // Esconder progresso
                                hideProgress();

                                // Mostrar sucesso
                                showStatus(
                                    "‚úÖ Foto enviada com sucesso!",
                                    "success",
                                );

                                // Alert de sucesso
                                alert("Foto enviada com sucesso!");

                                // Reabilitar bot√£o
                                selectBtn.disabled = false;
                                selectBtn.textContent = "Selecionar Foto";

                                // Limpar input
                                fileInput.value = "";

                                console.log(
                                    "üéâ PROCESSO CONCLU√çDO COM SUCESSO!",
                                );
                            },
                        );
                    },
                );
            }

            console.log("üî• Sistema de upload inicializado!");
            console.log("üìã Instru√ß√µes:");
            console.log("1. Substitua as credenciais Firebase na configura√ß√£o");
            console.log('2. Clique em "Selecionar Foto"');
            console.log("3. Escolha uma imagem do seu dispositivo");
            console.log("4. Acompanhe o progresso no console e na tela");
        </script>
    </body>
</html>
